<!DOCTYPE html>
<html>
<head>
<title>Draft With Respect</title>
  <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
  <link rel="stylesheet" href="template.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-typeahead.js"></script>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-97066876-1', 'auto');
  ga('send', 'pageview');
</script>


</head>

<body>
<nav class="navbar navbar-default navbar-static-top navbar-inverse">
  <div class="container">
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/"><span class="glyphicon glyphicon-home"></span> Home</a>
	  </li>
      <li class="active">
		  <a href="#jumbotron4">About Us</a>
	  </li>
	  <li class="active">
		  <a href="/howtohelp.html">How to Help</a>
	  </li>
	  <li class="active">
		  <a href="/thoughts.html">Thoughts about this site</a>
	  </li>
	  <li class="active">
		  <a href="/table.html">Table of Players</a>
	  </li>
  </div>
</nav>

<div id="how_to_help" class="jumbotron text-center">
      <h2>How can I help?</h2>
      <br>
    <h3>Question whether you can support players with a record of violence.</h3>
    Would you feel comfortable earning fantasy points from someone who has abused victims?<br>
    <br>
    <h3>Speak up when violence happens</h3>
    Whether it's a player on your team or someone you know<br>
    <br>
    <h3>Support victims; listen to what they have to say</h3>
    More than half of victims do not report to police for fear of repercussions.
</div>

<div id="jumbotron1" class="jumbotron text-center">
    <h1>#draftwithrespect</h1>
    <p>A resource for the fans that want the best players, on the field and off the field</p>
	<form class="form-inline" id="playerInput">
	  	<div class="form-group ui-widget">
    	<label for="playerInputBox">Search by name or team defense:</label>
   		<input type="text" class="form-control" id="playerInputBox" data-provide="typeahead">
	    </div>
        <button name="submit" type="submit" class="btn btn-default">Search</button>
	</form>
</div>

<div id="results_div" class="jumbotron text-center">
</div>

<div id="jumbotron3" class="jumbotron text-center">
  <h2>Are you drafting players that are violent towards women?</h2>
	We made this searchable database to help you draft the best players both on the field and off the field.<br>
	<br>
	<h3>It's time to #draftwithrespect.</h3>
</div>
<div id="jumbotron4" class="jumbotron text-center">
      <h2>About Us</h2>
      <p>Kelsey (an avid Cardinals fan) was drafting her fantasy team but didn't want any players with a history of violence against women. Googling each possible pick in her draft window was too slow and tiresome. So, we made this database to help her and other fantasy league managers #draftwithrespect.</p>  
</div>
<div id="missing_info" class="jumbotron text-center">
	<h2>Someone missing?</h2>
	<p><a href="https://docs.google.com/forms/d/e/1FAIpQLScafV97qq8MYCZzOu3xJqq2kc9fjByxfAtuwucEP4uk2T1eIw/viewform?usp=sf_link">Help add to our database</a>.
</div>
<div id="jumbotron5" class="jumbotron text-center">
      <h2>How This Was Made</h2>
      <p>At least two Google searches were performed for each player, e.g. "joe schmo domestic violence" and "joe schmo assault." The top 10 results were scanned for anything significant from a reputable source. Additional searching was done if a hit was found.</p>  
</div>


<script>
$.get("names.json", function(data){
  $("#playerInputBox").typeahead({ source:data });
},'json');
</script>

<script>
function addLink(link, linkNum, link_id_ht) {

	if (linkNum == 2) {
		$(link_id_ht).append(", ");
	}

	if (link.includes("npr")) {
		$(link_id_ht).append("<a href='" + link + "'>NPR</a>");
	} else if (link.includes("tmz")) {
		$(link_id_ht).append("<a href='" + link + "'>TMZ</a>");
	} else if (link.includes("vice")) {
		$(link_id_ht).append("<a href='" + link + "'>Vice</a>");
	} else if (link.includes("espn")) {
		$(link_id_ht).append("<a href='" + link + "'>ESPN</a>");
	} else if (link.includes("sfgate")) {
		$(link_id_ht).append("<a href='" + link + "'>SFGate</a>");
	} else if (link.includes("sbnation")) {
		$(link_id_ht).append("<a href='" + link + "'>SBNation</a>");
	} else if (link.includes("buzzfeed")) {
		$(link_id_ht).append("<a href='" + link + "'>BuzzFeed</a>");
	} else if (link.includes("usatoday")) {
		$(link_id_ht).append("<a href='" + link + "'>USA Today</a>");
	} else if (link.includes("cbssports")) {
		$(link_id_ht).append("<a href='" + link + "'>CBS Sports</a>");
	} else if (link.includes("dallasnews")) {
		$(link_id_ht).append("<a href='" + link + "'>Dallas News</a>");
	} else if (link.includes("bostonglobe")) {
		$(link_id_ht).append("<a href='" + link + "'>Boston Globe</a>");
	} else if (link.includes("tulsaworld")) {
		$(link_id_ht).append("<a href='" + link + "'>Tulsa World</a>");
	} else if (link.includes("denverpost")) {
		$(link_id_ht).append("<a href='" + link + "'>Denver Post</a>");
	} else if (link.includes("baltimoresun")) {
		$(link_id_ht).append("<a href='" + link + "'>Baltimore Sun</a>");
	} else if (link.includes("washingtonpost")) {
		$(link_id_ht).append("<a href='" + link + "'>Washington Post</a>");
	} else if (link.includes("bleacherreport")) {
		$(link_id_ht).append("<a href='" + link + "'>Bleacher Report</a>");
	} else if (link.includes("iowastatedaily")) {
		$(link_id_ht).append("<a href='" + link + "'>Iowa State Daily</a>");
	} else if (link.includes("seattletimes")) {
		$(link_id_ht).append("<a href='" + link + "'>Seattle Times</a>");
	} else if (link.includes("huffingtonpost")) {
		$(link_id_ht).append("<a href='" + link + "'>Huffington Post</a>");
	} else if (link.includes("si.com")) {
		$(link_id_ht).append("<a href='" + link + "'>Sports Illustrated</a>");
	} else {
		$(link_id_ht).append("<a href='" + link + "'>" + link + "</a>");
	}
}
</script>

<script>
function findAndDisplayDefenseData(teamAbbrev, data_defense) {
	
	for (t in data_defense.team_defenses) {
		if (t == teamAbbrev) {
			
			// report number of defensive players with incidents and without
			
			// first get number of listed incidents (may not be 1:1 with number of players)
			var numDefResults = data_defense.team_defenses[t].length;
			
			// calculate number of positive incidents, generate array of players
			var numDefIncidents = 0;
			var allDefNames = []	
			for (z = 0; z < numDefResults; z++) {
				if (data_defense.team_defenses[t][z].AssaultRelated == '1') {
					numDefIncidents += 1;
				}
				
				// calculate number of unique defensive players in incidents
				var name = data_defense.team_defenses[t][z].Name;
				allDefNames[z] = name;
			}
			var uniqueDefNames = Array.from(new Set(allDefNames));			
			var numDefPlayersUnique = uniqueDefNames.length;
			
			// calculate number of unique players with positive incidents, and without
			// assumes players without incident are listed only once
			var numDefPlayersDuplicateIncidents = numDefResults - numDefPlayersUnique;
			var numDefPlayersWithIncident = numDefIncidents - numDefPlayersDuplicateIncidents;
			var numDefPlayersNoIncident = numDefPlayersUnique - numDefPlayersWithIncident;
			
			// display count of players with and without incidents
			if (numDefPlayersUnique == 0) {
				$("#results_div").append("<p id='defense_summary' class='results'>We have not looked up any defensive players on this team. Stay tuned!</p>");
			} else if (numDefPlayersWithIncident == 0) {
				$("#results_div").append("<p id='defense_summary' class='results'>We found no defensive players on this team with significant records but we did find " + numDefPlayersNoIncident + " without significant records.</p>");
			} else if (numDefPlayersWithIncident == 1) {
				$("#results_div").append("<p id='defense_summary' class='results'>We found 1 defensive player on this team with significant records and " + numDefPlayersNoIncident + " players without significant records.</p>");
			} else {
				$("#results_div").append("<p id='defense_summary' class='results'>We found " + numDefPlayersWithIncident + " defensive players on this team with significant records and " + numDefPlayersNoIncident + " players without significant records.</p>");	
			}
			
			// display all incident data
			if (numDefResults > 0) {
			
				// display name, position, status, details, link
				for (y = 0; y < numDefResults; y++) {
				
					var name = data_defense.team_defenses[t][y].Name;
					var position = data_defense.team_defenses[t][y].Position;
					var status = data_defense.team_defenses[t][y].Status;
					var details = data_defense.team_defenses[t][y].Details;
					var link = data_defense.team_defenses[t][y].Link;
					
					$("#results_div").append("<p id='positionteam' class='results'><b>" + name + " (" + position + ")</b></p>")
					displayResults(status, details, link, y);
				}
				

			}
					
		}
	}
}
</script>

<script>
function findPlayerData(playerName, data_incidents, data_roster) {
	
	// find player name in incident data	
	var index_incident = []; // for counting number of incidents
	
	var assaultRelated_incident = [];
	var status_incident = [];
	var details_incident = [];
	var link_incident = [];
	
	for (i in data_incidents.incidents) {
		if (data_incidents.incidents[i].Name == playerName) {
			index_incident.push(i);
			
			assaultRelated_incident.push(data_incidents.incidents[i].AssaultRelated);
			status_incident.push(data_incidents.incidents[i].Status);
			details_incident.push(data_incidents.incidents[i].Details);
			link_incident.push(data_incidents.incidents[i].Link);	       
		}
    }

	// find player name in player team data    
    var names_roster = []; 			
	for (i in data_roster.name_pos_team) {
	    names_roster.push(data_roster.name_pos_team[i].Name)
    }
    var index_roster = names_roster.indexOf(playerName);
    
    // output data
    if (index_incident.length == 0 && index_roster == -1) {
    	return "not in both";
    } else if (index_incident.length == 0 && index_roster != -1) {
    	return ["not in incidents", data_roster.name_pos_team[index_roster].Position, data_roster.name_pos_team[index_roster].Team];
    } else if (index_incident.length > 0 && index_roster == -1) {
    	return ["not in roster", data_incidents.incidents[index_incident].Position, status_incident, details_incident, link_incident];
    } else {
		return ["found in both databases", data_roster.name_pos_team[index_roster].Position, data_roster.name_pos_team[index_roster].Team, status_incident, details_incident, link_incident];
	}
}
</script>


<script>
function displayPositionTeam(position, team) {
	// position and team	
	$("#results_div").append("<p id='positionteam' class='results'>Position: " + position + "<br>Team: " + team + "</p>")
}
</script>

<script>
function displayResults(status, details, link, j) {

	console.log(status)	
	console.log(details)
	console.log(link)
		
	// unique element ids if numIncidents > 1
	if (j == 0) {
		var status_id = 'status';
		var details_id = 'details';
		var link_id = 'link';
		var status_id_ht = '#status';
		var link_id_ht = '#link'
	} else {
		var status_id = 'status' + j;
		var details_id = 'details' + j;
		var link_id = 'link' + j;
		var status_id_ht = '#status' + j; // ht means hashtag
		var link_id_ht = '#link' + j;
	}
		
	// status
	$("#results_div").append("<h3 class='results'><span id='" + status_id + "' class='results'>" + status + "</span></h3>")

	// if no records found
	if (status == "No records found") {
		// color-code green
		$(status_id_ht).addClass("label label-success");
		
		// add links
		$("#results_div").append("<p id='" + link_id + "' class='results'>We thoroughly searched and couldn't find any relevant records online.</p>");
		
	} else if (status == "No assault-related records found" || status == "Not in database") {
		// color-code gray
		$(status_id_ht).addClass("label label-default");
		
		// add details
		$("#results_div").append("<p id='" + details_id + "' class='results'>" + details + "</p>");
	
	} else {

		// color-code status			
		if (status.indexOf("Wrongfully accused") != -1 || status.indexOf("not guilty") != -1) {
			$(status_id_ht).addClass("label label-success"); 
		} else if (status.indexOf("Accused") != -1 || status.indexOf("settled") != -1 || status.indexOf("Arrested") != -1 || status == "Pleaded guilty" || status == "Publicly admitted" || status == 'Found guilty' || status.indexOf("Plea deal") != -1) {
			$(status_id_ht).addClass("label label-danger"); 
		}	
		
		// add details
		$("#results_div").append("<p id='" + details_id + "' class='results'>" + details + "</p>");
		
		// add sources
		$("#results_div").append("<p id='" + link_id + "' class='results'>Source(s): </p>");

		// add links
		var splitLinks = link.split(',');
		if (splitLinks.length == 1) {
			addLink(link, 1, link_id_ht);
		} else if (splitLinks.length == 2) {
			addLink(splitLinks[0], 1, link_id_ht)
			addLink(splitLinks[1], 2, link_id_ht)
		}	
	}
}
</script>

<script>
function randomizePlaceholder() {
	
	var randNum = Math.random();
	
	if (randNum < 0.2) {
		var placeholderStr = "Ben Roethlisberger";
	} else if (randNum < 0.4) {
		var placeholderStr = "SEA defense (Seahawks)";
	} else if (randNum < 0.6) {
		var placeholderStr = "Ezekiel Elliott";
	} else if (randNum < 0.8) {
		var placeholderStr = "Tyreek Hill";
	} else {
		var placeholderStr = "Joe Mixon";
	}
	placeholderStr = "e.g. " + placeholderStr;

	$("#playerInputBox").attr("placeholder", placeholderStr);
}	
</script>

<script>
$(document).ready(function(){

	randomizePlaceholder()
	
	var url = window.location.href;
	var url_split = url.split('?');
	
	if (url_split.length == 2) {
		var query_url = url_split[1];
		var query_url_name = query_url.split('=')[1];
		query = query_url_name.replace(/\+/g, ' ');
		
		// remove any existing results
		$(".results").remove() 
		
		// load incident and player team data
		var incidents_json = (function() {
			var incidents_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "incidents.json",
				'dataType': "json",
				'success': function (data) {
					incidents_json = data;
				}
			});
			return incidents_json;
	    })();
	    
	    var roster_json = (function() {
			var roster_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "playerTeams.json",
				'dataType': "json",
				'success': function (data) {
					roster_json = data;
				}
			});
			return roster_json;
	    })();
	    
	    var defense_json = (function() {
			var defense_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "team_defenses.json",
				'dataType': "json",
				'success': function (data) {
					defense_json = data;
				}
			});
			return defense_json;
	    })();
        
        // display query
        $("#results_div").append("<h2 id='name' class='results'>" + query + "</p>")
        $("#results_div").css("padding", "48px 0px 40px 0px")
        
        // if the query is a team defense
        if (query.indexOf("defense") != -1) {

			var idx_space = query.indexOf(" ");
			var team_abbrev = query.substring(0, idx_space);
			
			if (team_abbrev == 'LAR') {
				team_abbrev = 'LA';
			}
			
			console.log(team_abbrev)

			findAndDisplayDefenseData(team_abbrev, defense_json);
        
        // if the query is a player name	
        } else { 
        	var playerName = query;
        	var result = findPlayerData(playerName, incidents_json, roster_json);
        	
        	// display data
			if (result == "not in both") {

				var position = 'not in database';
				var team = 'not active';
				var status = "Not in database";
				var details = "We haven't had time to research this player yet -- stay tuned for updates.";
				var link = "";
			
				displayPositionTeam(position, team)
				displayResults(status, details, link)

			} else if (result[0] == "not in incidents") { 

				var position = result[1];
				var team = result[2];
				var status = "Not in database";
				var details = "We haven't had time to research this player yet -- stay tuned for updates.";
				var link = "";
			
				displayPositionTeam(position, team)
				displayResults(status, details, link)

			} else if (result[0] == "not in roster") { 

				var position = result[1];
				var team = "not active";
				var status = result[2];
				var details = result[3];
				var link = result[4];
			
				displayPositionTeam(position, team)
				displayResults(status, details, link)

			} else {
			
				var status = result[3];
				var numIncidents = status.length;
				console.log(numIncidents);

				var position = result[1];
				var team = result[2];
				displayPositionTeam(position, team)

				for (j=0; j < numIncidents; j++) {
					status = result[3][j];
					details = result[4][j];
					link = result[5][j];

					displayResults(status, details, link, j)
				}		
			}
		}
	}
	
	
    $("#playerInput").submit(function(event){
		
		// process query based on player name
        var query_entered = $("#playerInputBox").val();
        query_entered = query_entered.trim();
        
        query_entered = query_entered.replace(/ /g, '+')
        
        console.log(query_entered)
		
		window.location.href = "?query="+query_entered;

        event.preventDefault();
    });
});
</script>


</body>
</html>