<!DOCTYPE html>
<html>
<head>
<title>Draft With Respect</title>
  <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
  <link rel="stylesheet" href="template.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-typeahead.js"></script>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-97066876-1', 'auto');
  ga('send', 'pageview');
</script>


</head>

<body>
<nav class="navbar navbar-default navbar-static-top navbar-inverse">
  <div class="container">
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/"><span class="glyphicon glyphicon-home"></span> Home</a>
      </li>
  </div>
</nav>

<div id="jumbotron1" class="jumbotron text-center">
    <h1>#draftwithrespect</h1>
    <p>A resource for the fans that want the best players, on the field and off the field</p>
	<form class="form-inline" id="playerInput">
	  	<div class="form-group ui-widget">
    	<label for="playerInputBox">Search by name:</label>
   		<input type="text" class="form-control" id="playerInputBox" placeholder="" data-provide="typeahead">
	    </div>
        <button name="submit" type="submit" class="btn btn-default">Search</button>
	</form>
</div>

<div id="results_div" class="jumbotron text-center">
</div>

<div id="jumbotron3" class="jumbotron text-center">
  <h2>Are you drafting players that are violent towards women?</h2>
	We made this searchable database to help you draft the best players both on the field and off the field.<br>
	<br>
	<h3>It's time to #draftwithrespect.</h3>
</div>
<div id="jumbotron4" class="jumbotron text-center">
      <h2>What you can do to help</h2>
      <br>
    <h3>Question whether you can support players with a record of domestic violence.</h3>
    Would you feel comfortable earning fantasy points from someone who has abused victims?<br>
    <br>
    <h3>Speak up when domestic violence happens</h3>
    Whether it's a player on your team or someone you know<br>
    <br>
    <h3>Support victims; listen to what they have to say</h3>
    More than half of victims do not report to police for fear of repercussions.
</div>


<script>
$.get("names.json", function(data){
  $("#playerInputBox").typeahead({ source:data });
},'json');
</script>

<script>
function findPlayerData(playerName, data_incidents, data_roster) {
	
	// find player name in incident data	
	var index_incident = [];
	var status_incident = [];
	var details_incident = [];
	var link_incident = [];
	
	for (i in data_incidents.incidents) {

	    index_incident.push(i);

	    status_incident.push(data_incidents.incidents[i].Status);
	    details_incident.push(data_incidents.incidents[i].Details);
   	    link_incident.push(data_incidents.incidents[i].Link);	       
    }

	// find player name in player team data    
    var names_roster = []; 			
	for (i in data_roster.name_pos_team) {
	    names_roster.push(data_roster.name_pos_team[i].Name)
    }
    var index_roster = names_roster.indexOf(playerName);
    
    // output data
    if (index_incident.length == 0 && index_roster == -1) {
    	return "not in both"; }
    else if (index_incident.length == 0 && index_roster != -1) {
    	return ["not in incidents", data_roster.name_pos_team[index_roster].Position, data_roster.name_pos_team[index_roster].Team];
    } else if (index_incident.length > 0 && index_roster == -1) {
    	return ["not in roster", data_incidents.incidents[index_incident].Position, status_incident, details_incident, link_incident];
    } else {
		return ["found in both databases", data_roster.name_pos_team[index_roster].Position, data_roster.name_pos_team[index_roster].Team, , status_incident, details_incident, link_incident];
	}
}
</script>

<script>
function displayResults(position, team, status, details, link) {
	
	// position and team	
	$("#results_div").append("<p id='positionteam' class='results'>Position: " + position + "<br>Team: " + team + "</p>")
		
	// status
	$("#results_div").append("<h3 id='status_span' class='results'><span id='status' class='results'>" + status + "</span></h3>")

	// if good guy
	if (status == "No records found") {
		// color-code green
		$("#status").addClass("label label-success");
		
		// add links
		$("#results_div").append("<p id='links' class='results'>We thoroughly searched and couldn't find any relevant records online.</p>");
		
	} else {

		// color-code status			
		if (status == "Arrested, not charged" || status == "Accused, not charged" || status.indexOf("settled") != -1) {
			$("#status").addClass("label label-warning"); 
		} else if (status == "Pleaded guilty" || status == "Publicly admitted" || status == 'Found guilty') {
			$("#status").addClass("label label-danger"); 
		}	
		
		// add details
		$("#results_div").append("<p id='details' class='results'>" + details + "</p>");
		
		// add sources
		$("#results_div").append("<p id='link' class='results'>Source(s): </p>");
		// add links
		if (link.includes("npr")) {
			$("#link").append("<a href='" + link + "'>NPR</a>");
		} else if (link.includes("espn")) {
			$("#link").append("<a href='" + link + "'>ESPN</a>");
		} else if (link.includes("sbnation")) {
			$("#link").append("<a href='" + link + "'>SBNation</a>");
		} else if (link.includes("usatoday")) {
			$("#link").append("<a href='" + link + "'>USA Today</a>");
		} else {
			$("#link").append("<a href=" + link + "'>" + link + "</a>");
		}	
	}
}
</script>

<script>
$(document).ready(function(){

    $("#playerInput").submit(function(event){
		
		// remove any existing results
		$(".results").remove() 

		// load incident and player team data
		var incidents_json = (function() {
			var incidents_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "incidents.json",
				'dataType': "json",
				'success': function (data) {
					incidents_json = data;
				}
			});
			return incidents_json;
	    })();
	    
	    var roster_json = (function() {
			var roster_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "roster.json",
				'dataType': "json",
				'success': function (data) {
					roster_json = data;
				}
			});
			return roster_json;
	    })();

		// process query based on player name
        var playerName = $("#playerInputBox").val();
        playerName = playerName.trim();
        $("#results_div").append("<h2 id='name' class='results'>" + playerName + "</p>")
        $("#results_div").css("padding", "48px 0px 40px 0px")
        
		var result = findPlayerData(playerName, incidents_json, roster_json);

		// display data
		if (result[0] == "not in both") {
			// no position and team
			position = 'not in database';
			team = "not active";
			$("#results_div").append("<p id='positionteam' class='results'>Position: " + result[1] + "<br>Team: " + team + "</p>")

			// no status, no details
			$("#results_div").append("<h3 id='status_span' class='results'><span id='status' class='results label label-default'>Not in database</span></h3>")
			$("#results_div").append("<p id='details' class='results'>We haven't had time to research this player yet -- stay tuned for updates.</p>");

		} else if (result[0] == "not in incidents") { 

			var position = result[1];
			var team = result[2];
			var status = "Not in database";
			var details = "We haven't had time to research this player yet -- stay tuned for updates.";
			var link = "";
			
			displayResults(position, team, status, details, link)

		} else if (result[0] == "not in roster") { 

			var position = result[1];
			var team = "not active";
			var status = result[2];
			var details = result[3];
			var link = result[4];
			
			displayResults(position, team, status, details, link)

		} else {
			var position = result[1];
			var team = result[2];
			var status = result[3];
			var details = result[4];
			var link = result[5];
			
			displayResults(position, team, status, details, link)
			
        }
        event.preventDefault();
    });
});
</script>


</body>
</html>