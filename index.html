<!DOCTYPE html>
<html>
<head>
<title>Draft With Respect</title>
  <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
  <link rel="stylesheet" href="template.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-typeahead.js"></script>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-97066876-1', 'auto');
  ga('send', 'pageview');
</script>


</head>

<body>
<nav class="navbar navbar-default navbar-static-top navbar-inverse">
  <div class="container">
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/"><span class="glyphicon glyphicon-home"></span> Home</a>
      </li>
  </div>
</nav>

<div class="jumbotron text-center">
  <div class="container">
    <h1>#draftwithrespect</h1>
    <p>A resource for the fans that want the best players, on the field and off the field</p>
	<form class="form-inline" id="playerInput">
	  	<div class="form-group ui-widget">
    	<label for="playerInputBox">Search by name:</label>
   		<input type="text" class="form-control" id="playerInputBox" placeholder="" data-provide="typeahead">
	    </div>
        <button name="submit" type="submit" class="btn btn-default">Search</button>
	</form>
  </div>
</div>

<div class="container">
	<div class="row">
		<div id="profile_div">
			<h2 id="name"></h2>
			<p id="positionteam"></p>
		</div>
		<h3><span id="status"></span></h3>
		<p id="details"></p>
		<p id="links"></p>
	</div>
</div>

<div class="container">
  <hr>
  <div class="row">
    <div class="col-md-6">
      <h3><span class="glyphicon glyphicon-info-sign"></span> Domestic violence happens</h3>
      <ul>
        <li>This app was deployed to Heroku, either using Git or by using <a href="https://github.com/heroku/python-getting-started">Heroku Button</a> on the repository.</li>

        <li>When Heroku received the source code, it fetched all the dependencies in the <a href="https://github.com/heroku/python-getting-started/blob/master/requirements.txt">requirements.txt file</a>, creating a deployable slug.</li>
        <li>The platform then spins up a dyno, a lightweight container that provides an isolated environment in which the slug can be mounted and executed.</li>
        <li>You can scale your app, manage it, and deploy over <a href="https://addons.heroku.com/">150 add-on services</a>, from the Dashboard or CLI.</li>
      </ul>
    </div>
    <div class="col-md-6">
      <h3><span class="glyphicon glyphicon-link"></span> What you can do to help</h3>
      <ul>
        <li>If you are following the <a href="https://devcenter.heroku.com/articles/getting-started-with-python">Getting Started</a> guide, then please head back to the tutorial and follow the next steps!</li>
        <li>If you deployed this app by deploying the Heroku Button, then in a command line shell, run:</li>
        <ul>
          <li><code>git clone https://github.com/heroku/python-getting-started.git</code> - this will create a local copy of the source code for the app</li>
          <li><code>cd python-getting-started</code> - change directory into the local source code repository</li>
          <li><code>heroku git:remote -a &lt;your-app-name></code> - associate the Heroku app with the repository</li>
          <li>You'll now be set up to run the app locally, or <a href="https://devcenter.heroku.com/articles/getting-started-with-python#push-local-changes">deploy changes</a> to Heroku</li>
        </ul>
      </ul>
    </div>
  </div> <!-- row -->
   <div class="alert alert-info text-center" role="alert">
    Please do work through the Getting Started guide, even if you do know how to build such an application.  The guide covers the basics of working with Heroku, and will familiarize you with all the concepts you need in order to build and deploy your own apps.
  </div>
</div>


<script>
$.get("names.json", function(data){
  $("#playerInputBox").typeahead({ source:data });
},'json');
</script>

<script>
function findPlayerData(playerName, data_incidents, data_roster) {
	
	// find player name in incident data
	var names_incidents = []; 			
	for (i in data_incidents.incidents) {
	    names_incidents.push(data_incidents.incidents[i].Name)
    }
    var index_incident = names_incidents.indexOf(playerName);
    
    var num_incidents = names_incidents.reduce(function(n, val) {
	    return n + (val === playerName);
	}, 0);

	// find player name in player team data    
    var names_roster = []; 			
	for (i in data_roster.name_pos_team) {
	    names_roster.push(data_roster.name_pos_team[i].Name)
    }
    var index_roster = names_roster.indexOf(playerName);
    
    // output data
    if (index_incident == -1 && index_roster == -1) {
    	return "not in both"; }
    else if (index_incident == -1 && index_roster != -1) {
    	return ["not in incidents", data_roster.name_pos_team[index_roster].Position, data_roster.name_pos_team[index_roster].Team];
    } else if (index_incident != -1 && index_roster == -1) {
    	return ["not in roster", data_incidents.incidents[index_incident].Position, data_incidents.incidents[index_incident].Status, data_incidents.incidents[index_incident].Details, data_incidents.incidents[index_incident].Link, num_incidents];
    } else {
		return ["found in both databases", data_roster.name_pos_team[index_roster].Position, data_roster.name_pos_team[index_roster].Team, data_incidents.incidents[index_incident].Status, data_incidents.incidents[index_incident].Details, data_incidents.incidents[index_incident].Link, num_incidents];
	}
	console.log(index_incident)
}
</script>

<script>
$(document).ready(function(){

    $("#playerInput").submit(function(event){

		// clear data display elements
    	$("#name").empty();
    	$("#positionteam").empty();

    	$("#status").empty();
		$("#status").removeClass();
    	$("#details").empty();
    	$("#links").empty();

		// load incident and player team data
		var incidents_json = (function() {
			var incidents_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "incidents.json",
				'dataType': "json",
				'success': function (data) {
					incidents_json = data;
				}
			});
			return incidents_json;
	    })();
	    
	    var playerTeams_json = (function() {
			var playerTeams_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "playerTeams.json",
				'dataType': "json",
				'success': function (data) {
					playerTeams_json = data;
				}
			});
			return playerTeams_json;
	    })();

		// process query based on player name
        var playerName = $("#playerInputBox").val();
        playerName = playerName.trim();
		var result = findPlayerData(playerName, incidents_json, playerTeams_json);

		// display data
		$("#profile_div").addClass("profile"); 		
		$("#name").append(playerName);
		
		if (result[0] == "not in both") {
			$("#status").addClass("label label-default");
			$("#status").append("Not in database");
			$("#details").append("We haven't had time to research this player yet -- stay tuned for updates.");

		} else if (result[0] == "not in incidents") { 
			$("#status").addClass("label label-default");
			$("#status").append("Not in database");
			$("#details").append("We haven't had time to research this player yet -- stay tuned for updates.");		
			$("#positionteam").append("Position: " + result[1] + "<br>" + "Team: " + result[2]);

		} else if (result[0] == "not in roster") { 
		
			$("#positionteam").append("Position: " + result[1] + "<br>" + "Team: not active");
		
			$("#status").append(result[2]);
			// color-code status			
			if (result[2] == "Arrested, not charged" || result[2] == "Accused, not charged" || result[2].indexOf("settled") != -1) {
				$("#status").addClass("label label-warning"); 
			} else if (result[2] == "Pleaded guilty" || result[2] == "Publicly admitted" || result[2] == 'Found guilty') {
				$("#status").addClass("label label-danger"); 
			}
			
			$("#details").append(result[3]);		
			
			$("#links").append("Source(s): ");
			// add links
			if (result[4].includes("npr")) {
				$("#links").append("<a href='" + result[4] + "'>NPR</a>");
			} else if (result[4].includes("espn")) {
				$("#links").append("<a href='" + result[4] + "'>ESPN</a>");
			} else if (result[4].includes("sbnation")) {
				$("#links").append("<a href='" + result[4] + "'>SBNation</a>");
			} else if (result[4].includes("usatoday")) {
				$("#links").append("<a href='" + result[4] + "'>USA Today</a>");
			} else {
				$("#links").append("<a href=" + result[4] + "'>" + result[4] + "</a>");
			}

		} else {

			$("#positionteam").append("Position: " + result[1] + "<br>" + "Team: " + result[2]);
		
			if (result[3] == "No records found") {
				$("#status").addClass("label label-success");
				$("#status").append(result[3]);
				$("#links").append("We thoroughly searched and couldn't find any relevant records online.");
				
			} else {

				// color-code status			
				if (result[3] == "Arrested, not charged" || result[3] == "Accused, not charged" || result[3].indexOf("settled") != -1) {
					$("#status").addClass("label label-warning"); 
				} else if (result[3] == "Pleaded guilty" || result[3] == "Publicly admitted" || result[3] == 'Found guilty') {
					$("#status").addClass("label label-danger"); 
				}	

				// add status
				$("#status").append(result[3]);
				
				// add details
				$("#details").append(result[4]);
				
				$("#links").append("Source(s): ");
				// add links
				if (result[5].includes("npr")) {
					$("#links").append("<a href='" + result[5] + "'>NPR</a>");
				} else if (result[5].includes("espn")) {
					$("#links").append("<a href='" + result[5] + "'>ESPN</a>");
				} else if (result[5].includes("sbnation")) {
					$("#links").append("<a href='" + result[5] + "'>SBNation</a>");
				} else if (result[5].includes("usatoday")) {
					$("#links").append("<a href='" + result[5] + "'>USA Today</a>");
				} else {
					$("#links").append("<a href=" + result[5] + "'>" + result[5] + "</a>");
				}
				
			}
			
        }
        event.preventDefault();
    });
});
</script>


</body>
</html>