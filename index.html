<!DOCTYPE html>
<html>
<head>
<title>Draft With Respect</title>
  <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
  <link rel="stylesheet" href="template.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-typeahead.js"></script>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-97066876-1', 'auto');
  ga('send', 'pageview');
</script>


</head>

<body>
<nav class="navbar navbar-default navbar-static-top navbar-inverse">
  <div class="container">
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/"><span class="glyphicon glyphicon-home"></span> Home</a>
      </li>
  </div>
</nav>

<div id="jumbotron1" class="jumbotron text-center">
    <h1>#draftwithrespect</h1>
    <p>A resource for the fans that want the best players, on the field and off the field</p>
	<form class="form-inline" id="playerInput">
	  	<div class="form-group ui-widget">
    	<label for="playerInputBox">Search by name:</label>
   		<input type="text" class="form-control" id="playerInputBox" placeholder="" data-provide="typeahead">
	    </div>
        <button name="submit" type="submit" class="btn btn-default">Search</button>
	</form>
</div>

<div id="results_div" class="jumbotron text-center">
	<h2 id="name"></h2>
	<p id="positionteam"></p>
	<h3 id="status_span"><span id="status"></span></h3>
	<p id="details"></p>
	<p id="links"></p>
</div>

<div id="jumbotron3" class="jumbotron text-center">
  <h2>Are you drafting players that are violent towards women?</h2>
	We made this searchable database to help you draft the best players both on the field and off the field.<br>
	<br>
	<h3>It's time to #draftwithrespect.</h3>
</div>
<div id="jumbotron4" class="jumbotron text-center">
      <h2>What you can do to help</h2>
      <br>
    <h3>Question whether you can support players with a record of domestic violence.</h3>
    Would you feel comfortable earning fantasy points from someone who has abused victims?<br>
    <br>
    <h3>Speak up when domestic violence happens</h3>
    Whether it's a player on your team or someone you know<br>
    <br>
    <h3>Support victims; listen to what they have to say</h3>
    More than half of victims do not report to police for fear of repercussions.
</div>


<script>
$.get("names.json", function(data){
  $("#playerInputBox").typeahead({ source:data });
},'json');
</script>

<script>
function findPlayerData(playerName, data_incidents, data_roster) {
	
	// find player name in incident data
	var names_incidents = []; 			
	for (i in data_incidents.incidents) {
	    names_incidents.push(data_incidents.incidents[i].Name)
    }
    var index_incident = names_incidents.indexOf(playerName);
    
    var num_incidents = names_incidents.reduce(function(n, val) {
	    return n + (val === playerName);
	}, 0);

	// find player name in player team data    
    var names_roster = []; 			
	for (i in data_roster.name_pos_team) {
	    names_roster.push(data_roster.name_pos_team[i].Name)
    }
    var index_roster = names_roster.indexOf(playerName);
    
    // output data
    if (index_incident == -1 && index_roster == -1) {
    	return "not in both"; }
    else if (index_incident == -1 && index_roster != -1) {
    	return ["not in incidents", data_roster.name_pos_team[index_roster].Position, data_roster.name_pos_team[index_roster].Team];
    } else if (index_incident != -1 && index_roster == -1) {
    	return ["not in roster", data_incidents.incidents[index_incident].Position, data_incidents.incidents[index_incident].Status, data_incidents.incidents[index_incident].Details, data_incidents.incidents[index_incident].Link, num_incidents];
    } else {
		return ["found in both databases", data_roster.name_pos_team[index_roster].Position, data_roster.name_pos_team[index_roster].Team, data_incidents.incidents[index_incident].Status, data_incidents.incidents[index_incident].Details, data_incidents.incidents[index_incident].Link, num_incidents];
	}
	console.log(index_incident)
}
</script>

<script>
$(document).ready(function(){

    $("#playerInput").submit(function(event){

		// clear data display elements
    	$("#name").empty();
    	$("#positionteam").empty();

    	$("#status").empty();
		$("#status").removeClass();
    	$("#details").empty();
    	$("#links").empty();

		// load incident and player team data
		var incidents_json = (function() {
			var incidents_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "incidents.json",
				'dataType': "json",
				'success': function (data) {
					incidents_json = data;
				}
			});
			return incidents_json;
	    })();
	    
	    var playerTeams_json = (function() {
			var playerTeams_json = null;
			$.ajax({
				'async': false,
				'global': false,
				'url': "playerTeams.json",
				'dataType': "json",
				'success': function (data) {
					playerTeams_json = data;
				}
			});
			return playerTeams_json;
	    })();

		// process query based on player name
        var playerName = $("#playerInputBox").val();
        playerName = playerName.trim();
		var result = findPlayerData(playerName, incidents_json, playerTeams_json);

		// display data
		$("profile_div").css("background","#000099")
		$("profile_div").css("padding","30px 15 40 15")
		$("#name").css("margin", "")
		$("#positionteam").css("margin-top", "21px")
		$("#positionteam").css("margin-bottom", "42px")
		$("#status_span").css("margin-top", "20px")
		$("#status_span").css("margin-bottom", "10px")
		$("#details").css("margin-top", "21px")
		$("#details").css("margin-bottom", "42px")
		$("#links").css("margin-top", "21px")
		
		$("#name").append(playerName);
		
		if (result[0] == "not in both") {
			$("#status").addClass("label label-default");
			$("#status").append("Not in database");
			$("#details").append("We haven't had time to research this player yet -- stay tuned for updates.");

		} else if (result[0] == "not in incidents") { 
			$("#status").addClass("label label-default");
			$("#status").append("Not in database");
			$("#details").append("We haven't had time to research this player yet -- stay tuned for updates.");		
			$("#positionteam").append("Position: " + result[1] + "<br>" + "Team: " + result[2]);

		} else if (result[0] == "not in roster") { 
		
			$("#positionteam").append("Position: " + result[1] + "<br>" + "Team: not active");
		
			$("#status").append(result[2]);
			// color-code status			
			if (result[2] == "Arrested, not charged" || result[2] == "Accused, not charged" || result[2].indexOf("settled") != -1) {
				$("#status").addClass("label label-warning"); 
			} else if (result[2] == "Pleaded guilty" || result[2] == "Publicly admitted" || result[2] == 'Found guilty') {
				$("#status").addClass("label label-danger"); 
			}
			
			$("#details").append(result[3]);		
			
			$("#links").append("Source(s): ");
			// add links
			if (result[4].includes("npr")) {
				$("#links").append("<a href='" + result[4] + "'>NPR</a>");
			} else if (result[4].includes("espn")) {
				$("#links").append("<a href='" + result[4] + "'>ESPN</a>");
			} else if (result[4].includes("sbnation")) {
				$("#links").append("<a href='" + result[4] + "'>SBNation</a>");
			} else if (result[4].includes("usatoday")) {
				$("#links").append("<a href='" + result[4] + "'>USA Today</a>");
			} else {
				$("#links").append("<a href=" + result[4] + "'>" + result[4] + "</a>");
			}

		} else {

			$("#positionteam").append("Position: " + result[1] + "<br>" + "Team: " + result[2]);
		
			if (result[3] == "No records found") {
				$("#status").addClass("label label-success");
				$("#status").append(result[3]);
				$("#links").append("We thoroughly searched and couldn't find any relevant records online.");
				
			} else {

				// color-code status			
				if (result[3] == "Arrested, not charged" || result[3] == "Accused, not charged" || result[3].indexOf("settled") != -1) {
					$("#status").addClass("label label-warning"); 
				} else if (result[3] == "Pleaded guilty" || result[3] == "Publicly admitted" || result[3] == 'Found guilty') {
					$("#status").addClass("label label-danger"); 
				}	

				// add status
				$("#status").append(result[3]);
				
				// add details
				$("#details").append(result[4]);
				
				$("#links").append("Source(s): ");
				// add links
				if (result[5].includes("npr")) {
					$("#links").append("<a href='" + result[5] + "'>NPR</a>");
				} else if (result[5].includes("espn")) {
					$("#links").append("<a href='" + result[5] + "'>ESPN</a>");
				} else if (result[5].includes("sbnation")) {
					$("#links").append("<a href='" + result[5] + "'>SBNation</a>");
				} else if (result[5].includes("usatoday")) {
					$("#links").append("<a href='" + result[5] + "'>USA Today</a>");
				} else {
					$("#links").append("<a href=" + result[5] + "'>" + result[5] + "</a>");
				}
				
			}
			
        }
        event.preventDefault();
    });
});
</script>


</body>
</html>